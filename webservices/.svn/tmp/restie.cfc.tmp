<cfcomponent rest="true" restpath="/hello">


	<cffunction name="getsome" access="remote" returntype="string" httpmethod="GET" restpath="/getsome">
		<cfreturn '[1,2,3,4,4,7]' />
	</cffunction>


	<cffunction name="getall" access="remote" returntype="string" httpMethod="GET" restPath="/getall">
		<cfscript>
			var intRow			= 0;
			var arrCategories	= [];
			var stuArtefact		= {};
			var qAllArtefacts = application.oNearestBusiness.getAll();
			
			/*
			[
				{
				"id": 1,
					"categoryId": 2,
					"fltLongitude": -0.111537,
					"fltLatitude": 51.51817
				},
				{
					"id": 2,
					"categoryId": 3,
					"fltLongitude": -0.097589,
					"fltLatitude": 51.514912
				}
			]
			*/
			
			//Data needs to be an array of objects, so we'll use structs and let serializeJson do the work.
			for(intRow = 1; intRow LT qAllArtefacts.RecordCount; intRow ++){
				stuArtefact	= {
					id				= qAllArtefacts.intArtefactId[intRow], 
					categoryId		= qAllArtefacts.intCategoryID[intRow], 
					fltLongitude	= qAllArtefacts.gpsLongitude[intRow], 
					fltLatitude		= qAllArtefacts.gpsLatitude[intRow]
				};
				arrCategories[intRow]	= stuArtefact;
			}
		
			return serializeJson(arrCategories);
		</cfscript>
	</cffunction>

	<cffunction name="getsome" access="remote" returntype="string" httpMethod="GET" restPath="/getsome">
		<cfreturn "hello">
	</cffunction>


	<cffunction name="getCategories" access="remote" returntype="string" httpmethod="GET" restpath="/getcategories" hint="I get all available categories">
		<cfscript>
			var intRow			= 0;
			var arrCategories	= [];
			var qCategories		= application.oNearestBusiness.getAllCategories();
			//json to be returned in format as such:
			//[{"NAME":"Post Office","ID":1},{"NAME":"Phone Box","ID":2},{"NAME":"Post Box","ID":3},{"NAME":"Cash Point","ID":4},{"NAME":"Hospital","ID":5}] ]
		
			//Data needs to be an array of objects, so we'll use structs and let serializeJson do the work.
			for(intRow = 1; intRow LT qCategories.RecordCount; intRow ++){
				arrCategories[intRow]	= {id = qCategories.intCategoryId[intRow], name = qCategories.strCategoryName[intRow]};
			}
			
			return serializeJson(arrCategories);
		</cfscript>
	</cffunction>

<<<<<<< .mine
	<cffunction name="findNearest" access="remote" returntype="string" httpmethod="GET" restpath="/findnearest" output="false" hint="I take in latitude and longitude and return all artefacts with a given categoryID and their distance from that lat and long.">
		<cfargument name="intCategoryID"	type="numeric" required="true"	restArgSource="Path">
		<cfargument name="fltLatitude"		type="numeric" required="true"	restArgSource="Path">
		<cfargument name="fltLongitude"		type="numeric" required="true"	restArgSource="Path">
		<cfargument name="intDistance"		type="numeric" required="true"	restArgSource="Path"/>
=======

	<cffunction name="getNearest" access="remote" returntype="string" httpMethod="GET" restPath="/getnearest/intcategoryid/{intcategoryid}/fltLatitude/{fltLatitude}/fltLongitude/{fltLongitude}/intDistance/{intDistance}">
		<cfargument name="intCategoryId"	type="numeric"	restArgSource="Path">
		<cfargument name="fltLatitude"		type="numeric"	restArgSource="Path">
		<cfargument name="fltLongitude"		type="numeric"	restArgSource="Path">
		<cfargument name="intDistance"		type="numeric"	restArgSource="Path">
>>>>>>> .r187
		<cfscript>
			var intRow			= 0;
			var arrCategories	= [];
			var stuArtefact		= {};
			var qArtefacts		= application.oNearestBusiness.findNearest(argumentCollection = arguments);
			
			//Data needs to be an array of objects, so we'll use structs and let serializeJson do the work.
			for(intRow = 1; intRow LTE qArtefacts.RecordCount; intRow ++){
				stuArtefact	= {
					id				= qArtefacts.intArtefactId[intRow], 
					categoryId		= qArtefacts.intCategoryID[intRow],
					fltDistance		= qArtefacts.fltDistance[intRow],
					strName			= qArtefacts.strName[intRow],
					strJsIconName	= qArtefacts.strJsIconName[intRow],
					fltLongitude	= qArtefacts.gpsLongitude[intRow], 
					fltLatitude		= qArtefacts.gpsLatitude[intRow]
				};
				arrCategories[intRow]	= stuArtefact;
			}
		
			return serializeJson(arrCategories);
		</cfscript>
	</cffunction>


</cfcomponent>